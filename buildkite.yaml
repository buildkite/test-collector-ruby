steps:
  - label: ":rspec: Tests :ruby: {{matrix}}"
    command:
      - "bundle"
      - "bundle exec rake"
    plugins:
      - docker#v3.7.0:
          image: "445615400570.dkr.ecr.us-east-1.amazonaws.com/ecr-public/docker/library/ruby:{{matrix}}"
    matrix:
      - "3.2.2"
      - "3.1.4"
      - "3.0.6"
      - "2.7.8"
  - group: ":rspec: Legacy Ruby :ruby:"
    steps:
      - label: ":rspec: Tests :ruby: {{matrix}}"
        command:
          - "gem install bundler:2.3.25"
          - "bundle"
          - "bundle exec rake"
        soft_fail: true
        plugins:
          - docker#v3.7.0:
              # Images for older Ruby versions aren't available on AWS ECR
              # so fall back to Docker Hub
              image: "ruby:{{matrix}}"
        matrix:
          - "2.6.10"
          - "2.5.9"
          - "2.4.10"
          - "2.3.8"
